<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Functional Test of PART broker</title>
<style type="text/css">
  h2 { margin-left:-2%; color: blue; background: white; }
  h1 { margin-left:-4%; color: red; background: white; }
  h2 { margin-left:-2%; color: blue; background: white; }
  h3 { margin-left:-2%; color: blue; background: white; }
  h4 { margin-left:-2%; color: blue; background: white; }
  body { margin-left:5%; color: black; background: white; }
  code { color: black; background-color:yellow;}
  li { width: 1000; list-style: none;}
</style>

  </head>

  <body>
    <h1>Functional Test of the PART CPR Broker</h1>
    
This is a test of the CPR broker. It is mainly a black-box test using Soap UI

UUIDs used for input in this test are created using <a href="http://createguid.com/"> CreateGUUID</a>.

<pre>
Applicatíon1 token : 12BDB789-A8C0-452A-89E4-297F3583C3FB
</pre>


<h2> How to perform the tests</H2>


This test is performed with the installation of the broker on the Gentofte network, <url>http://cprbroker20110208</url>

Install SoapUI.
Create projects for the three webservices: 

<ul>
<li>http://cprbroker20110208/Services/Admin.asmx?WSDL</li>
<li>http://cprbroker20110208/Services/Part.asmx?WSDL</li>
<li>http://eventbroker20110208/Services/Notification.asmx?WSDL</li>
<li>http://eventbroker20110208/Services/Subscriptions.asmx?WSDL</li>
</ul>


We also check the application page: http://cprbroker20110208/Pages/Applications.aspx

<p>

Fill in input for east test and check the output. 

The test are basicly black-box test that study mostly XML request and XML replies, a few of files (e.g. notification file channels to verify delivery of notifications), the web pages for administration, and a few queries on the database.

For example for request registration. We supply
<pre>
<p style="background-color:yellow;width:90%">
&lt;soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:dk="http://dk.itst"&gt;
   &lt;soap:Header&gt;
      &lt;dk:ApplicationHeader&gt;
      &lt;/dk:ApplicationHeader&gt;
   &lt;/soap:Header&gt;
   &lt;soap:Body&gt;
      &lt;dk:RequestAppRegistration&gt;
         &lt;!--Optional:--&gt;
         &lt;dk:ApplicationName&gt;testapp10&lt;/dk:ApplicationName&gt;
      &lt;/dk:RequestAppRegistration&gt;
   &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;

</p>
</pre>

And the result is 

<quote>
<pre>
<p style="background-color:yellow;width:90%">
&lt;soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	  xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
   &lt;soap:Body&gt;
      &lt;RequestAppRegistrationResponse xmlns="http://dk.itst"&gt;
         &lt;Application xmlns="http://rep.oio.dk/cpr.dk/xml/schemas/2009/07/01/"&gt;
            &lt;ApplicationId&gt;eb29494a-187d-481e-87c3-7e4a2472fc58&lt;/ApplicationId&gt;
            &lt;Token&gt;1f267ed0-1704-4df1-86b9-b3428945412e&lt;/Token&gt;
            &lt;Name&gt;testapp10&lt;/Name&gt;
            &lt;RegistrationDate&gt;2011-02-14T10:11:23.5466856+01:00&lt;/RegistrationDate&gt;
            &lt;IsApproved&gt;false&lt;/IsApproved&gt;
            &lt;ApprovedDate&gt;0001-01-01T00:00:00&lt;/ApprovedDate&gt;
         &lt;/Application&gt;
      &lt;/RequestAppRegistrationResponse&gt;
   &lt;/soap:Body&gt;
&lt;/soap:Envelope
</p>
</pre>
</quote>

We do the same for testapp11 but this time leave in the optional header to ensure that it does not make a differens. The application headers contain the credentials necessary for accessing the CPR Broker. They are necessary for all applications and all operation - except the request for approval.
<p>

Then we use the ApproveAppRegistration test case to approve the request for testapp10. To bootstrap this test we have to use the master admin token:


<quote>
<pre>
<p style="background-color:yellow;width:90%">
&lt;soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:dk="http://dk.itst"&gt;
   &lt;soap:Header&gt;
      &lt;dk:ApplicationHeader&gt;
         &lt;!--Optional:--&gt;
         &lt;dk:ApplicationToken&gt;07059250-E448-4040-B695-9C03F9E59E38&lt;/dk:ApplicationToken&gt;
         &lt;!--Optional:--&gt;
         &lt;dk:UserToken&gt;Base application&lt;/dk:UserToken&gt;
      &lt;/dk:ApplicationHeader&gt;
   &lt;/soap:Header&gt;
   &lt;soap:Body&gt;
      &lt;dk:ApproveAppRegistration&gt;
         &lt;!--Optional:--&gt;
         &lt;dk:ApplicationToken&gt;1f267ed0-1704-4df1-86b9-b3428945412e&lt;/dk:ApplicationToken&gt;
      &lt;/dk:ApproveAppRegistration&gt;
   &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</p></pre>
</quote>


And get the reciepts.

<quote>
<pre>
<p style="background-color:yellow;width:90%">

&lt;soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
   &lt;soap:Body&gt;
      &lt;ApproveAppRegistrationResponse xmlns="http://dk.itst"&gt;
         &lt;ApproveAppRegistrationResult&gt;true&lt;/ApproveAppRegistrationResult&gt;
      &lt;/ApproveAppRegistrationResponse&gt;
   &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</p>
</pre>
</quote>


We can then also check that the admin web user interface agrees with this state of affairs:


At <url>http://cprbroker20110208/Pages/Applications.aspx</url> we see:

<pre>
	<table cellspacing="0" cellpadding="2" rules="all" border="1" id="ctl00_Contents_applicationsGridView" style="border-collapse:collapse;">
		<tr class="GridHeader" style="white-space:nowrap;">
			<th scope="col" style="white-space:nowrap;">Name</th><th scope="col" style="white-space:nowrap;">Token</th><th scope="col">Registration date</th><th scope="col">Approved</th><th scope="col">Approved date</th><th scope="col">&nbsp;</th><th scope="col">&nbsp;</th>
		</tr><tr class="Row">
			<td style="white-space:nowrap;">
                    <span id="ctl00_Contents_applicationsGridView_ctl02_Label1">CPR Business Application Demo</span>
                </td><td style="white-space:nowrap;">
                    <span id="ctl00_Contents_applicationsGridView_ctl02_Label2">5f8b7af5-422e-46bb-9273-5e244dc37505</span>
                </td><td>14-12-2010 12:31:09</td><td><span disabled="disabled"><input id="ctl00_Contents_applicationsGridView_ctl02_ctl00" type="checkbox" name="ctl00$Contents$applicationsGridView$ctl02$ctl00" checked="checked" disabled="disabled" /></span></td><td>&nbsp;</td><td><a class="CommandButton" href="javascript:__doPostBack('ctl00$Contents$applicationsGridView','Edit$0')">Edit</a></td><td><a class="CommandButton" href="javascript:__doPostBack('ctl00$Contents$applicationsGridView','Delete$0')">Delete</a></td>
		</tr>		</tr><tr class="AlternateRow">
			<td style="white-space:nowrap;">
                    <span id="ctl00_Contents_applicationsGridView_ctl09_Label1">testapp10</span>
                </td><td style="white-space:nowrap;">
                    <span id="ctl00_Contents_applicationsGridView_ctl09_Label2">1f267ed0-1704-4df1-86b9-b3428945412e</span>
                </td><td>14-02-2011 10:11:23</td><td><span disabled="disabled"><input id="ctl00_Contents_applicationsGridView_ctl09_ctl00" type="checkbox" name="ctl00$Contents$applicationsGridView$ctl09$ctl00" checked="checked" disabled="disabled" /></span></td><td>10-02-2011 18:25:59</td><td><a class="CommandButton" href="javascript:__doPostBack('ctl00$Contents$applicationsGridView','Edit$7')">Edit</a></td><td><a class="CommandButton" href="javascript:__doPostBack('ctl00$Contents$applicationsGridView','Delete$7')">Delete</a></td>
		</tr><tr class="Row">
			<td style="white-space:nowrap;">
                    <span id="ctl00_Contents_applicationsGridView_ctl10_Label1">testapp11</span>
                </td><td style="white-space:nowrap;">
                    <span id="ctl00_Contents_applicationsGridView_ctl10_Label2">5fad3c95-1f85-439d-b2cc-3ae84e074787</span>
                </td><td>14-02-2011 10:29:51</td><td><span disabled="disabled"><input id="ctl00_Contents_applicationsGridView_ctl10_ctl00" type="checkbox" name="ctl00$Contents$applicationsGridView$ctl10$ctl00" disabled="disabled" /></span></td><td>&nbsp;</td><td><a class="CommandButton" href="javascript:__doPostBack('ctl00$Contents$applicationsGridView','Edit$8')">Edit</a></td><td><a class="CommandButton" href="javascript:__doPostBack('ctl00$Contents$applicationsGridView','Delete$8')">Delete</a></td>
		</tr>
	</table>
<pre>

This show that the user web interface work, that it confirms that testapp4 was approved and that testapp11 is not approved.




<h2>Registration of applications</h2>

We first check that the Demo application is able to register using the Admin Webservice

<table border="1" style="border-collapse: collapse">
<tr> <th>Testcase</th> <th>Service</th> <th>Interface</th> <th>web admin GUI</th> <th>Result and notes</th></tr>
<tr><td>RequestAppRegistration name=testapp10</td><td>admin.asmx</td><td>soapIO</td>checked<td></td><td>with the optional soap headers removed, result:  ApplicationId=eb29494a-187d-481e-87c3-7e4a2472fc58, token=1f267ed0-1704-4df1-86b9-b3428945412e, IsApproved=false</td></tr>

<tr><td>RequestAppRegistration name=testApp11</td><td>admin.asmx</td><td>soapIO</td><td>checked</td><td>ApplicationId=a30ba5fc-f06a-4771-9070-921c7002c234,token=5fad3c95-1f85-439d-b2cc-3ae84e074787, IsApproved=false</td></tr>
<tr><td>List app registration</td><td>admin.asmx</td><td>soapUI</td><td></td><td></td></tr>
<tr><td>Approve registration name=testApp1</td><td>admin.asmx</td><td>soapIO</td><td></td><td></td></tr>
<tr><td>List app registration</td><td>admin.asmx</td><td>soapUI</td><td></td><td>used testapp10 token to authenticate this requst. Result gave Same data as web admin gui, except sorting</td></tr>
<tr><td>RequestAppRegistration name=testAppT</td><td>admin.asmx</td><td>soapIO</td><td></td><td></td></tr>
<tr><td>Approve registration name=testAppT</td><td>admin.asmx</td><td>soapIO</td><td></td><td>Just to approve an application, we can unregister</td></tr>
<tr><td>List app registration</td><td>admin.asmx</td><td>soapUI</td><td></td><td>testappT is approved</td></tr>

<tr><td>Unregister testApp1</td><td>admin.asmx</td><td></td><td></td><td>UnregisterAppResult=true</td></tr>
<tr><td>List app registration</td><td>admin.asmx</td><td>soapUI</td><td></td><td>testappT is not in the list</td></tr>
<tr><td>Ping using testApp1 registration token</td><td>admin.asmx?op=Ping</td><td>SoapUI</td><td></td><td>PingResult>User=[/ ], Auth type=[], IsAuthenticated=[False], Server=[USVMV361]</td></tr>
<tr><td>get DataProviderList</td><td>admin.asmx?op=GetDataProviderList</td><td></td><td></td><td>list of dataproviders. Passwords is not hashed, but this has been fixed in newer revisions of the code.</td></tr>

<tr><td>set DataProviderList</td><td>admin.asmx?op=SetDataProviderList</td><td></td><td></td><td>not tested yet. Will be tested last as it can change the state of the broker.</td></tr>

</table>


Now we have tested the admin services. We still have one registered application, testApp10, that we can use to authorize the next test cases:


<h2>PART</h2>

In the following we implicitly use testApp2 registrations.

<h3> UUID og CPR number </h3>


<h4>  CPR number to UUID</h4>

First we test getPersonUUID which takes a CPR number and returns a UUID. If the CPR Broker do not already have the CPR number in its database, it will invoke the PersonMaster web service.

<table border="1" style="border-collapse: collapse">
<tr> <th>Testcase</th> <th>Service</th> <th>Interface</th> <th>DB</th> <th>Result and notes</th></tr>

<tr><td>CPR number lookup, exist in GTK</td> <td>Part?op=GetPersonUuid</td><td>SoapUI</td><td></td><td>UUID returned (last four digits removed after test)</td></tr>
<tr><td>CPR number lookup, exist but not in GTK</td> <td>Part?op=GetPersonUuid</td><td>SoapUI</td><td></td><td>Niels looklup, uuid returned (last four digits removed after test).</td></tr>
<tr><td>CPR number lookup, does not exist</td> <td>Part?op=GetPersonUuid</td><td>SoapUI</td><td></td><td>a4baafe3-d3c7-4d0a-91a7-0efe5f2f9742, obtained from PersonMaster</td></tr>
<tr><td>invalid CPR number</td> <td>Part?op=GetPersonUuid</td><td>SoapUI</td><td></td><td>00000000-0000-0000-0000-000000000000, should return INVALID INPUT, we will investigate whether the CPR Broker or PersonMaster should validate CPR numbers</td></tr>
</table>

<h4> READ </h4>

Now we test Read, which take a UUID and return data on the person identified by the UUID.


<table border="1" style="border-collapse: collapse">
<tr> <th>Testcase</th> <th>Service</th> <th>Interface</th> <th>DB</th> <th>Result and notes</th></tr>
<tr><td>UUID of person in GTK, not in broker</td> <td>Part?op=Read</td><td>SoapUI</td><td></td><td>reply with info on person, QualityLevel=DataProvider</td></tr>
<tr><td>UUID of person not in GTK, in broker</td> <td>Part?op=Read</td><td>SoapUI</td><td></td><td>replyt with info on person, QualityLevelLocalCache</td></tr>
<tr><td>UUID does not exist in PART</td> <td>Part?op=Read</td><td>SoapUI</td><td></td><td> 

 &lt;StandardRetur xmlns="urn:oio:sagdok:2.0.0"&gt;
               &lt;StatusKode&gt;NOT_FOUND&lt;/StatusKode&gt;
               &lt;FejlbeskedTekst&gt;UUID valid but not found : Invalid input&lt;/FejlbeskedTekst&gt;
            &lt;/StandardRetur&gt;

</td></tr>
<tr><td>Invalid UUID</td> <td>Part?op=Read</td><td>SoapUI</td><td></td><td>

  &lt;StandardRetur xmlns="urn:oio:sagdok:2.0.0"&gt;
               &lt;StatusKode&gt;BAD_CLIENT_REQUEST&lt;/StatusKode&gt;
               &lt;FejlbeskedTekst&gt;Invalid UUID: 42&lt;/FejlbeskedTekst&gt;
            &lt;/StandardRetur&gt;

</td></tr>
</table>
    


<h2>Eventbroker</h2>

The Event Broker allow client to subscribe to events.
We will first test the subscribtion, then the delivery of events.

<h3>subscription</h3>

We set up two webservice channels webservice1 and webservice2.
They just accept anything and writes it to a logfile.


<p>
<table border="1" style="border-collapse: collapse">
<tr> <th>Testcase</th> <th>Service</th> <th>Interface</th> <th>DB</th> <th>Result and notes</th></tr>
<tr><td>Ping</td><td>Subscriptions.asmx?op=Ping</td><td>SoapUI</td><td></td><td>User=[/ ], Auth type=[], IsAuthenticated=[False], Server=[USVMV361]</td></tr>

<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td>Empty</td></tr>
<tr><td>Subscribe(fileshare1, [existing uuid])</td><td>Subscriptions.asmx?op=Subscribe</td><td>SoapUI</td><td></td><td>got SubscribeResponse with SubscriptionId>982ebe30-0d42-42c2-a9bb-91a9ad468c96, ApplicationToken = 07059250-E448-4040-B695-9C03F9E59E38 (sub1) </td></tr>
<tr><td>Subscribe(fileshare2, [not existing uuid])</td><td>Subscriptions.asmx?op=Subscribe</td><td>SoapUI</td><td></td><td>   
&lt;soap:Body&gt;      &lt;SubscribeResponse xmlns="http://dk.itst"/&gt; &lt;/soap:Body&gt;, should return error
</td></tr>
<tr><td>Subscribe(fileshare3, empty list)</td><td>Subscriptions.asmx?op=Subscribe</td><td>SoapUI</td><td></td><td>&lt;soap:Body&gt;&lt;SubscribeResponse xmlns="http://dk.itst"/&gt; &lt;/soap:Body&gt;, should return error
</td></tr>
<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Subscribe(webservice1, [existing uuid])</td><td>Subscriptions.asmx?op=Subscribe</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Subscribe(webservice2, [existing uuid,existing uuid,existing uuid])</td><td>Subscriptions.asmx?op=Subscribe</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>UnSubscribe(sub1)</td><td>Subscriptions.asmx?op=Unsubscribe</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>UnSubscribe(not existing subscription)</td><td>Subscriptions.asmx?op=Unsubscribe</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Birthday(fileshare4, priorDays=1, years=42, CPRno)</td><td>Subscriptions.asmx?op=SubscribeOnbirthday</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Birthday(fileshare5, priorDays=-1, years=42, CPRno)</td><td>Subscriptions.asmx?op=SubscribeOnbirthday</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Birthday(fileshare5, priorDays=1, years=-42, CPRno)</td><td>Subscriptions.asmx?op=SubscribeOnbirthday</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Birthday(fileshare5, priorDays=0, years=-42, CPRno)</td><td>Subscriptions.asmx?op=SubscribeOnbirthday</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Birthday(fileshare6, priorDays=10, years=64, [CPRno1,cpr2])</td><td>Subscriptions.asmx?op=SubscribeOnbirthday</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>Birthday(fileshare7, priorDays=10, years=64, empty_list)</td><td>Subscriptions.asmx?op=SubscribeOnbirthday</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>GetActiveSubscriptionsList, for all persons</td><td>Subscriptions.asmx?op=GetActiveSubscriptionsList</td><td>SoapUI</td><td></td><td></td></tr>
</table>

<h4>notification</h4>

<ol>
<li>check fileshare 1-6</li>
<li>check log from dummy webservice 1-2</li>
</ol>


<h3>Refresh Read</h3>
<table border="1" style="border-collapse: collapse">
<tr> <th>Testcase</th> <th>Service</th> <th>Interface</th> <th>DB</th> <th>Result and notes</th></tr>
<tr><td>Invalid UUID</td> <td>Part?op=RefreshRead</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>UUID does not exist</td> <td>Part?op=RefreshRead</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>UUID=uuid1 does not exist in PART</td> <td>Part?op=RefreshRead</td><td>SoapUI</td><td>First update in GTK test DPR, then do RefreshRead, then check the broker DB</td><td></td></tr>
<tr><td>read uuid1</td> <td>Part?op=Read</td><td>SoapUI</td><td>should be the version from DPR</td><td></td></tr>
<tr><td>UUID=uuid2 of person in PART</td> <td>Part?op=RefreshRead</td><td>SoapUI</td><td></td><td></td></tr>
<tr><td>read uuid2</td> <td>Part?op=Read</td><td>SoapUI</td><td>should be the version from DPR</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td></tr>
</table>



    <hr>
    <address><a href="mailto:elgaard@niels.magenta-aps.dk">Niels Elgaard Larsen</a></address>
<!-- Created: Mon Feb  7 15:53:17 CET 2011 -->
<!-- hhmts start -->
Last modified: Mon Feb 14 19:30:00 Romance Standard Time 2011
<!-- hhmts end -->
  </body>
</html>
